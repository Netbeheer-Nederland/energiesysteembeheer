<footer class="site-footer">
    <a href="https://github.com/netbeheer-nederland/begrippen" style="text-decoration: none; color: inherit; display: inline-flex; align-items: center; gap: 8px;">
    <svg height="20" width="20" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
        <path d="M12 0C5.37 0 0 5.37 0 12c0 5.31 3.435 9.795 8.205 11.385.6.105.825-.255.825-.57 0-.285-.015-1.05-.015-2.07-3.345.72-4.05-1.605-4.05-1.605-.54-1.38-1.335-1.755-1.335-1.755-1.095-.75.09-.735.09-.735 1.215.09 1.845 1.245 1.845 1.245 1.08 1.86 2.835 1.32 3.525 1.005.105-.78.42-1.32.765-1.62-2.67-.3-5.475-1.335-5.475-5.925 0-1.305.465-2.385 1.23-3.225-.12-.3-.54-1.53.12-3.18 0 0 1.005-.315 3.3 1.23.96-.27 1.98-.405 3-.405 1.02 0 2.04.135 3 .405 2.28-1.56 3.285-1.245 3.285-1.245.66 1.65.24 2.88.12 3.18.765.84 1.23 1.905 1.23 3.225 0 4.605-2.805 5.625-5.475 5.925.435.375.81 1.095.81 2.22 0 1.605-.015 2.895-.015 3.285 0 .315.225.69.825.57A12.02 12.02 0 0 0 24 12c0-6.63-5.37-12-12-12z"/>
    </svg>
    <span>Bekijk de broncode</span>
    </a>
</footer>

<!--                  -->
<!-- NAVIGATIE TOGGLE -->
<!--                  -->

<span id="skos-toggle-container" class="fw-500" style="display:none"> - <span class="text-purple-000" style="cursor:pointer" id="btn-toggle-nav">alfabatisch</span></span>

<ul id="skos-az-list" class="nav-list" style="display:none">
    <li id="skos-loading-container" class="nav-list-item">
        <span id="skos-loading-msg" class="nav-list-link">Laden...</span>
    </li>
</ul>

<script>
  document.addEventListener("DOMContentLoaded", function() {
    const sidebar = document.querySelector('.site-nav');
    const navCategory = document.querySelector('.nav-category');
    const originalList = document.querySelector('.site-nav > .nav-category + .nav-list');
    const azList = document.getElementById('skos-az-list');
    const toggleContainer = document.getElementById('skos-toggle-container');
    const btn = document.getElementById('btn-toggle-nav');
    const loadingContainer = document.getElementById('skos-loading-container');
    const loadingMsg = document.getElementById('skos-loading-msg');

    let dataLoaded = false;
    const jsonUrl = "{{ '/assets/begrippenlijst.json' | relative_url }}";

    function scrollToActive() {
      const activeLink = azList.querySelector('.active');
      if (activeLink) activeLink.scrollIntoView({block: 'center'}); 
    }

    function loadAndRenderData() {
      if (dataLoaded) return;

      fetch(jsonUrl)
        .then(response => response.json())
        .then(data => {
          const currentPath = window.location.pathname.replace(/\/$/, "");

          let listHTML = "";

          data.forEach(item => {
            const itemUrlClean = item.url.replace(/\/$/, "");
            const isActive = item.type !== 'alias' && (currentPath.endsWith(itemUrlClean) || itemUrlClean.endsWith(currentPath));
            let cssClass = 'nav-list-link';
            if (isActive) cssClass += ' active';

            let itemHTML = item.title;
            if (item.type === 'alias') itemHTML = '<span class="text-grey-dk-000">' + item.title + ' &rarr; </span>' + item.target_label;

            listHTML += '<li class="nav-list-item">';
            listHTML += '<a href="' + item.url + '" class="' + cssClass + '">' + itemHTML + '</a>';
            listHTML += '</li>';
          });

          azList.innerHTML = listHTML;
          loadingContainer.style.display = 'none';
          dataLoaded = true;
          scrollToActive();
        })
        .catch(err => {
          loadingMsg.textContent = "Fout bij laden begrippenlijst";
          console.error(err);
        });
    }

    function setNavMode(mode) {
      if (mode === 'az') {
        originalList.style.display = 'none';
        azList.style.display = 'block';
        btn.textContent = 'hiÃ«rarchisch';
        localStorage.setItem('skos-nav-pref', 'az');
        if (!dataLoaded) {
          loadAndRenderData(); 
        } else {
          scrollToActive();
        }
      } else {
        originalList.style.display = 'block';
        azList.style.display = 'none';
        btn.textContent = 'alfabetisch'; 
        localStorage.setItem('skos-nav-pref', 'tree');
      }
    }

    if (sidebar && navCategory && originalList && toggleContainer && azList) {
      navCategory.appendChild(toggleContainer);
      toggleContainer.style.display = 'inline';
      sidebar.insertBefore(azList, originalList);
      originalList.id = "skos-tree-list";

      const savedPref = localStorage.getItem('skos-nav-pref');
      if (savedPref === 'az') setNavMode('az');

      btn.addEventListener('click', function() {
        if (azList.style.display === 'none') {
          setNavMode('az');
        } else {
          setNavMode('tree');
        }
      });
    }
  });
</script>
